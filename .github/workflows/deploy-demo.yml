name: Deploy Demo to GitHub Pages

on:
  push:
    branches: [ master ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Setup .NET
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: 10.0.x # Oder 9.0.x, je nach deinem Projekt

      - name: Publish WASM Project
        # Hier den Pfad zu deinem NEUEN Projekt anpassen:
        run: dotnet publish samples/Blazor.SimpleGrid.WasmSample/Blazor.SimpleGrid.WasmSample.csproj -c Release -o output

      - name: Fix for GitHub Pages
        run: |
          # Pfad zur index.html im WASM-Output
          INDEX_FILE="output/wwwroot/index.html"
          
          if [ -f "$INDEX_FILE" ]; then
            echo "Patche index.html für GitHub Pages..."
            # WICHTIG: Ersetze 'Blazor.SimpleGrid' durch deinen Repo-Namen auf GitHub
            sed -i 's/<base href="\/" \/>/<base href="\/Blazor.SimpleGrid\/" \/>/g' "$INDEX_FILE"
            
            # Kopiere index.html zu 404.html, damit Deep-Links (wie /demo) funktionieren
            cp "$INDEX_FILE" "output/wwwroot/404.html"
          else
            echo "FEHLER: index.html nicht gefunden. Prüfe den Pfad!"
            exit 1
          fi

      - name: Upload to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4
        with:
          folder: output/wwwroot
          branch: gh-pages